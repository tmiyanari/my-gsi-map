<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <title>編集できる地理院地図２</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        #console-log { position: absolute; bottom: 30px; left: 10px; background: white; padding: 10px; max-width: 300px; max-height: 100px; overflow: auto; border: 2px solid #FF4500; z-index: 10; }
/* 描画中のポインタを強制的に有効にする */
.mapboxgl-canvas-container.mapboxgl-interactive,
.maplibregl-canvas-container.maplibregl-interactive {
    cursor: crosshair !important;
}

/* 描画コントロールが他の要素に隠れないようにする */
.mapboxgl-ctrl-group, .maplibregl-ctrl-group {
    z-index: 100 !important;
}        
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="console-log">ここに座標が出ます</div>
<div id="controls" style="position: absolute; top: 10px; left: 50px; z-index: 100;">
    <button id="btn-add-point" style="padding: 10px; cursor: pointer;">地点を追加（クリックしてON）</button>
</div>

<script>
    // ...地図の初期化などはそのまま...

    const draw = new MapboxDraw({
        displayControlsDefault: false // 標準ボタンは隠す
    });
    map.addControl(draw);

    let isAddMode = false;
    const addBtn = document.getElementById('btn-add-point');

    addBtn.onclick = () => {
        isAddMode = !isAddMode;
        addBtn.style.background = isAddMode ? '#ff4500' : '#fff';
        addBtn.innerText = isAddMode ? '地図をクリックして配置' : '地点を追加';
    };

    map.on('click', (e) => {
        if (!isAddMode) return;

        // 1. クリックした場所に点を生成
        const feature = {
            type: 'Feature',
            properties: { name: '新規地点', time: new Date().toLocaleString() },
            geometry: { type: 'Point', coordinates: [e.lngLat.lng, e.lngLat.lat] }
        };

        // 2. 描画ツールにデータを追加
        draw.add(feature);

        // 3. コンソールに現在の全データ（GeoJSON）を出力
        const allData = draw.getAll();
        console.log("現在の全データ:", JSON.stringify(allData));
        
        // 画面のログ表示を更新
        document.getElementById('console-log').innerText = `追加完了: ${e.lngLat.lng.toFixed(4)}`;
    });
</script>
</body>
</html>
