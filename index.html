<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8" />
    <title>ç·¨é›†ã§ãã‚‹åœ°ç†é™¢åœ°å›³</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.4.3/mapbox-gl-draw.css" />
    
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        /* ãƒœã‚¿ãƒ³ãªã©ã®UIãƒ¬ã‚¤ãƒ¤ãƒ¼ */
        #ui-panel { position: absolute; top: 10px; left: 10px; z-index: 100; display: flex; flex-direction: column; gap: 10px; }
        button { padding: 10px; cursor: pointer; background: white; border: 2px solid #333; border-radius: 4px; font-weight: bold; }
        #console-log { background: rgba(255, 255, 255, 0.9); padding: 10px; border: 1px solid #ccc; max-width: 250px; font-size: 12px; pointer-events: none; }
    </style>
</head>
<body>

    <div id="ui-panel">
        <button id="btn-add-point">ğŸ“ åœ°ç‚¹è¿½åŠ ãƒ¢ãƒ¼ãƒ‰: OFF</button>
        <div id="console-log">åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦åº§æ¨™ã‚’å–å¾—</div>
    </div>
    
    <div id="map"></div>

    <script>
        // 1. åœ°å›³ã®åˆæœŸåŒ–
        const map = new maplibregl.Map({
            container: 'map',
            style: {
                version: 8,
                sources: {
                    'gsi-tiles': {
                        type: 'raster',
                        tiles: ['https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png'],
                        tileSize: 256,
                        attribution: "åœ°ç†é™¢åœ°å›³"
                    }
                },
                layers: [{ id: 'gsi-layer', type: 'raster', source: 'gsi-tiles' }]
            },
            center: [139.767, 35.681],
            zoom: 12
        });

        // 2. æç”»ãƒ„ãƒ¼ãƒ«ã®åˆæœŸåŒ–
        const draw = new MapboxDraw({
            displayControlsDefault: false
        });
        map.addControl(draw);

        let isAddMode = false;
        const addBtn = document.getElementById('btn-add-point');
        const logDiv = document.getElementById('console-log');

        // ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        addBtn.onclick = () => {
            isAddMode = !isAddMode;
            addBtn.style.background = isAddMode ? '#ff4500' : '#fff';
            addBtn.style.color = isAddMode ? '#fff' : '#000';
            addBtn.innerText = isAddMode ? 'ğŸ“ åœ°å›³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦é…ç½®' : 'ğŸ“ åœ°ç‚¹è¿½åŠ ãƒ¢ãƒ¼ãƒ‰: OFF';
        };

        // åœ°å›³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        map.on('click', (e) => {
    if (!isAddMode) return;

    // 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å…¥åŠ›ã‚’æ±‚ã‚ã‚‹ï¼ˆç°¡æ˜“çš„ãªå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ï¼‰
    const locationName = prompt("å ´æ‰€ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„", "æ–°è¦åœ°ç‚¹");
    
    // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸå ´åˆã¯ä¸­æ–­
    if (locationName === null) return;

    const coords = [e.lngLat.lng, e.lngLat.lat];
    
    // 2. æç”»ãƒ„ãƒ¼ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ï¼ˆå…¥åŠ›ã•ã‚ŒãŸåå‰ã‚’ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å…¥ã‚Œã‚‹ï¼‰
    draw.add({
        type: 'Feature',
        properties: { 
            name: locationName, 
            time: new Date().toLocaleString() 
        },
        geometry: { type: 'Point', coordinates: coords }
    });

    // 3. ãƒ­ã‚°ã¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’æ›´æ–°
    logDiv.innerText = `ã€Œ${locationName}ã€ã‚’è¿½åŠ ã—ã¾ã—ãŸ`;
    console.log("æœ€æ–°ã®GeoJSON:", JSON.stringify(draw.getAll()));
});
    </script>
</body>
</html>
